<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Intersol Messenger - Suite</title>
    <style>
        :root { --msn-blue: #0078d7; --msn-bg: #e5effa; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--msn-bg); display: flex; justify-content: center; align-items: center; height: 100vh; }
        
        .msn-window { width: 320px; height: 550px; background: white; border: 1px solid #a0b4cd; display: flex; flex-direction: column; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .msn-header { background: linear-gradient(to bottom, #fcfdfe, #e5effa); padding: 15px; border-bottom: 1px solid #a0b4cd; }
        
        .user-info { display: flex; align-items: center; gap: 10px; }
        .avatar { width: 45px; height: 45px; border: 2px solid white; box-shadow: 0 0 3px gray; background: #eee; }
        .user-name { font-weight: bold; font-size: 14px; color: #333; }
        .user-status { font-size: 12px; color: #666; }

        .contact-list { flex-grow: 1; overflow-y: auto; padding: 10px; background: white; }
        
        /* ESTILO DE GRUPOS */
        .group-header { font-size: 11px; font-weight: bold; color: #555; padding: 10px 5px 5px 5px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        
        .contact-item { display: flex; align-items: center; padding: 5px; cursor: pointer; border-radius: 3px; position: relative; }
        .contact-item:hover { background: #f0f7ff; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; border: 1px solid rgba(0,0,0,0.1); }
        .online { background: #31a24c; }
        .offline { background: #ccc; }
        
        /* ESTRELLA DE FAVORITOS */
        .fav-star { margin-left: auto; color: #ccc; font-size: 16px; transition: 0.2s; cursor: pointer; padding: 0 5px; }
        .fav-star.active { color: #ffb400; text-shadow: 0 0 2px rgba(0,0,0,0.2); }
        .fav-star:hover { transform: scale(1.2); }

        .msn-footer { padding: 10px; background: #f9f9f9; border-top: 1px solid #ddd; text-align: center; }
        .btn-mail { color: var(--msn-blue); text-decoration: none; font-size: 12px; font-weight: bold; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="msn-window">
        <div class="msn-header">
            <div class="user-info">
                <img src="https://ui-avatars.com/api/?name=User&background=0078d7&color=fff" class="avatar" id="my-avatar">
                <div>
                    <div class="user-name" id="my-name">Cargando...</div>
                    <div class="user-status">Disponible ‚ñæ</div>
                </div>
            </div>
        </div>

        <div class="contact-list" id="contact-list">
            <div id="group-favs" class="hidden">
                <div class="group-header">FAVORITOS ‚≠ê</div>
                <div id="list-favs"></div>
            </div>

            <div class="group-header">AMIGOS (<span id="count-friends">0</span>)</div>
            <div id="list-friends"></div>
        </div>

        <div class="msn-footer">
            <a href="hotmail.html" class="btn-mail">üìß Ir a Intersol Mail</a>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

    const firebaseConfig = { apiKey: "AIzaSyAWMmRpC9chHuBMWbMCRFeEzhQjh1dJ0Uw", databaseURL: "https://intersol-ce061-default-rtdb.firebaseio.com" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const session = JSON.parse(localStorage.getItem('intersol_user'));
    if(!session) window.location.href = "hotmail.html"; // Redirigir al login si no hay sesi√≥n

    document.getElementById('my-name').innerText = session.email.split('@')[0];
    document.getElementById('my-avatar').src = `https://ui-avatars.com/api/?name=${session.email}&background=0078d7&color=fff`;

    // --- CARGAR CONTACTOS ---
    onValue(ref(db, 'intersol/usuarios'), (snap) => {
        const listFavs = document.getElementById('list-favs');
        const listFriends = document.getElementById('list-friends');
        const groupFavs = document.getElementById('group-favs');
        
        listFavs.innerHTML = "";
        listFriends.innerHTML = "";
        
        let friendsCount = 0;
        let hasFavs = false;

        snap.forEach(child => {
            const user = child.val();
            if(user.email === session.email) return; // No mostrarse a uno mismo

            friendsCount++;
            
            // Ver si es favorito (basado en una lista en el perfil del usuario actual)
            // Para simplicidad, guardamos los favoritos en una rama local del usuario
            const isFav = session.favoritos && session.favoritos.includes(user.email);
            if(isFav) hasFavs = true;

            const item = document.createElement('div');
            item.className = 'contact-item';
            item.innerHTML = `
                <div class="status-dot online"></div>
                <div style="font-size: 13px;">${user.email.split('@')[0]}</div>
                <div class="fav-star ${isFav ? 'active' : ''}" onclick="toggleFavorito('${user.email}')">‚òÖ</div>
            `;

            if(isFav) {
                listFavs.appendChild(item);
            } else {
                listFriends.appendChild(item);
            }
        });

        document.getElementById('count-friends').innerText = friendsCount;
        groupFavs.className = hasFavs ? "" : "hidden";
    });

    // --- L√ìGICA DE FAVORITOS ---
    window.toggleFavorito = (email) => {
        let favs = session.favoritos || [];
        if(favs.includes(email)) {
            favs = favs.filter(e => e !== email);
        } else {
            favs.push(email);
        }
        
        // Actualizamos la sesi√≥n local
        session.favoritos = favs;
        localStorage.setItem('intersol_user', JSON.stringify(session));
        
        // Forzamos refresco visual
        location.reload(); 
    };
</script>
</body>
</html>
